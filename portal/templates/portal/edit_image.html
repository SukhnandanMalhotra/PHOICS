{% load staticfiles %}
<!DOCTYPE html>
<html>


<head>
       <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>


    <script>


    $(document).ready(function() {
        $('#id_width').change(function() {

            var width = $(this).val();
            console.log(width);
            if (width <= 0){
                $('#error_image_width').text("enter valid width");
                return false;
            }
            var imgid = $(".Form").attr("id");

            $.ajax({
                url: '{% url 'width_image' %}',
                data: {
                    'width': width,
                    'imgid': imgid
                },

                success: function (data) {


                        $( ".image-display" ).attr("src", "/media/" + data.img_source );
                }

            })
        });



        $('#id_height').change(function() {

            var height = $(this).val();

            if (height <= 0){
                $('#error_image_height').text("enter valid height");
                return false;
            }
        });


        $("#id_rotate").change(function () {
            var rotate = $(this).val();
            var imgid = $(".Form").attr("id");
            var img_source = $(".image-display").attr("id");

            $.ajax({
                url: '{% url 'rotate_image' %}',
                data: {
                    'rotate': rotate,
                    'imgid': imgid
                },

                success: function (data) {


                        $( ".image-display" ).attr("src", "/media/" + data.img_source );
                }

            })
        }) ;
         $("#id_blur").change(function () {
            var blur = $(this).val();
            var imgid = $(".Form").attr("id");
            var img_source = $(".image-display").attr("id");

            $.ajax({
                url: '{% url 'blur_image' %}',
                data: {
                    'blur': blur,
                    'imgid': imgid
                },

                success: function (data) {
                          console.log("blurring");

                        $( ".image-display" ).attr("src", "/media/" + data.img_source );
                }

            })
        }) ;

         $("#id_flip").change(function () {
            var flip = $("#id_flip").val();
            var imgid = $(".Form").attr("id");
            var img_source = $(".image-display").attr("id");
            var height = $("id_height").val();
            var width = $("id_width").val();
            var effect = $("id_effect").val();
            var rotate = $("id_rotate").val();
            var blur = $("id_blur").val();
            $.ajax({
                url: '{% url 'flip_image' %}',
                data: {
                    'flip': flip,
                    'imgid': imgid,
                    'height': height,
                    'width': width,
                    'effect': effect,
                    'rotate': rotate,
                    'blur': blur
                },

                success: function (data) {
                          console.log("flip");

                        $( ".image-display" ).attr("src", "/media/" + data.img_source );
                }

            })
        }) ;
         $("#id_effect").change(function () {
            var effect = $(this).val();
            var imgid = $(".Form").attr("id");
            var img_source = $(".image-display").attr("id");
            console.log("prev -:" + img_source);

            $.ajax({
                url: '{% url 'effect_image' %}',
                data: {
                    'effect': effect,
                    'imgid': imgid
                },

                success: function (data) {
                          console.log("effect");

                        $( ".image-display" ).attr("src", "/media/" + data.img_source );
                        console.log("new:-" + data.img_source);
                }

            })
        }) ;
    })
    </script>
    <script>
        function preview(event)
        {

            console.log("imagination");
            var reader = new FileReader();
            reader.onload = function()
            {
                var output = document.getElementById('output');
                output.src = reader.result;
            };
            reader.readAsDataURL(event.target.files[0]);
        }
    </script>

	<title>upload file</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{% static 'portal/Upload.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
    <div id="top">
        <h2>PHOICS</h2>
{#        <a href="{% url 'search' %}"><i class="fa fa-search fa-2x" aria-hidden="true"></i></a>#}
        <a href="{% url 'newsfeed' %}"><i class="fa fa-home fa-2x" aria-hidden="true"></i></a>
        <a href="{% url 'profile' user.username %}">	<i class="fa fa-user fa-2x" aria-hidden="true"></i></a>
        <a href="{% url 'logout' %}"><i class="fa fa-sign-out fa-2x" aria-hidden="true"></i></a>
    </div>
    <div class="container">
        <div class="content heading"><p class="upload" ><p style="text-align: center; font-size: 200%">
            {{ user.username }}</p><br><br>{{ title }}</div>
        <div class="content form">
             <div class="Form" id="{{ updatex.id }}">

                    {% if request.user.is_authenticated %}

                         <form method='post' enctype="multipart/form-data" novalidate onsubmit="preview(event)">

                                {% csrf_token %}



                                 <div class="row">
                                     <label for="name">{{ form.status.label_tag }}</label>
                                      {{ form.status }}<br>
                                      <p id="error_image_status" style="color: #ff0000">{{ form.status.errors }}
                                 </div>

                                 <div class="row">
                                     <label for="name">{{ form.width.label_tag }}</label>
                                      {{ form.width }}<br>
                                      <p id="error_image_width" style="color: #ff0000">{{ form.width.errors }}
                                 </div>

                                 <div class="row">
                                     <label for="name">{{ form.height.label_tag }}</label>
                                      {{ form.height }}<br>
                                      <p id="error_image_height" style="color: #ff0000">{{ form.height.errors }}
                                 </div>

                                 <div class="row">
                                     <label for="name">{{ form.rotate.label_tag }}</label>
                                      {{ form.rotate }}<br>
                                      <p id="error_image_rotate" style="color: #ff0000">{{ form.rotate.errors }}
                                 </div>

                                 <div class="row">
                                     <label for="name">{{ form.flip.label_tag }}</label>
                                      {{ form.flip }}<br>
                                      <p id="error_image_flip" style="color: #ff0000">{{ form.flip.errors }}
                                 </div>

                                 <div class="row">
                                     <label for="name">{{ form.blur.label_tag }}</label>
                                      {{ form.blur }}<br>
                                      <p id="error_image_blur" style="color: #ff0000">{{ form.blur.errors }}
                                 </div>

                                 <div class="row">
                                     <label for="name">{{ form.effect.label_tag }}</label>
                                      {{ form.effect }}<br>
                                      <p id="error_image_effect" style="color: #ff0000">{{ form.effect.errors }}
                                 </div>
                            <button class="button" type="submit">SUBMIT</button><br>
                         </form>
{#                    {% else %}#}
{#                    <h3>first logged in</h3>#}
                    {% endif %}

                 </div>
            </div>

        <div class="content preview">
                <h3>current photo</h3>
                <div><img id="{{ updatex.document.url }}" class="image-display" src="{{ updatex.document.url }}"></div>
            </div>
        </div>
</body>
</html>